# A Protein Language Model for Exploring Viral 1 Fitness Landscapes
摘要  
连续出现的SARS-CoV-2变种导致了通过增强的传播潜力（即适应性）重复的疫情激增。建模基因型与适应性的关系使我们能够准确指出增强病毒适应性的突变，并在检测到高风险变种后立即进行标记。在此，我们介绍了CoVFit，这是一个蛋白质语言模型，能够仅根据其刺突蛋白序列预测变种的适应性。CoVFit的训练使用了从病毒基因组监测和与免疫逃逸相关的功能性突变数据中得到的基因型–适应性数据。仅限于在XBB出现前的可用数据，CoVFit成功预测了XBB谱系的更高适应性。经充分训练的CoVFit识别了直到2023年底SARS-CoV-2进化过程中的549个适应性提升事件。此外，基于CoVFit的模拟能够在检测到之前预测JN.1亚型的更高适应性。我们的研究提供了对SARS-CoV-2适应性格局的洞察，以及一种可能转变病毒基因组监测的新工具。  

## 引言

控制病毒性传染病的主要挑战之一源于病毒通过突变进化的能力。在COVID-19大流行期间，具有增强传播潜力（即适应性）的SARS-CoV-2变体在宿主群体中相继出现，导致了一次又一次的疫情激增。通过研究SARS-CoV-2的方式了解病毒如何在大流行中增强其适应性，我们可以获得管理COVID-19以及未来病毒性传染病的关键洞察。  

SARS-CoV-2变体的适应性可以通过有效再生数（Re）进行比较。Re代表在特定条件下，一个感染者引起的平均次级感染数。由于病毒基因组监测的进步，现在几乎可以实时估算SARS-CoV-2变体的相对Re。基于估计的相对Re，我们可以预测在特定时间内，在共同流行的病毒中哪个变体具有最大优势，可能会成为下一个主导变体。我们的团队，G2P-Japan联盟，已经成功使用Re估计来预测即将出现的主导变体，并通过病毒学实验进一步阐明了这些变体的特征和风险。  

由于变体在特定条件下的适应性由其基因型决定，原则上可以从其基因组或蛋白质序列预测变体的适应性。通过建立适应性预测模型，我们可以识别有助于增加病毒适应性的突变。此外，一个可靠的适应性预测模型将使变体监测系统更为高效，理想情况下能够在最初的基因组序列公布时即刻识别下一个主导变体。更重要的是，由于病毒通常朝着增加其适应性的方向进化，了解病毒的适应性格局可以预测其进化方向。  

SARS-CoV-2通过在病毒蛋白中获得突变（包括替换、插入和删除），尤其强调刺突（S）蛋白，来增强其适应性。S蛋白是病毒通过与血管紧张素转换酶2（ACE2）受体相互作用进入宿主细胞的必需糖蛋白。同时，S蛋白是中和抗体的主要靶标，这些抗体是疫苗接种或自然感染引发的体液免疫反应的关键组成部分。因此，能够影响S蛋白与ACE2的结合效率及其逃避中和抗体的能力的突变往往对病毒适应性有更强的影响。  

SARS-CoV-2的进化过程可以分为顺序和非顺序（或跃变式）两种。Omicron BA.1、BA.2、XBB和BA.2.86谱系是通过跃变式过程出现的，通过各种机制（包括重组等）在S蛋白中获得了大约15个以上的突变。相比之下，Omicron BA.5、BQ.1.1及XBB的后代是从其亲本谱系顺序进化而来的，在S蛋白中获得的突变数量较少，通常为三个或更少。预测通过跃变式进化出现的变体的适应性，预计将比通过顺序进化出现的变体更具挑战性。  

以往的研究，包括我们的研究，已经开发出了基于变体的突变模式预测其适应性的方法，这些方法采用统计建模方法。然而，这些统计模型仅将适应性表示为个别突变效应的线性组合，没有考虑突变之间的相互作用，即上位性。此外，这些统计模型无法考虑到训练数据集创建时尚未出现的突变的效应。我们认为，这些挑战可以通过使用创新的蛋白质语言模型来解决。大型语言模型（LLMs）在自然语言处理领域越来越受欢迎。蛋白质语言模型是在蛋白质序列的综合数据集上预训练的LLMs，使其能够学习蛋白质的一般模式。值得注意的是，我们可以对预训练的蛋白质语言模型进行微调，以解决特定任务，如适应性预测。此外，通过采用适用于深度学习模型（如蛋白质语言模型）的多任务学习框架，我们可以将突变的功能信息整合到适应性预测过程中，从而可能提高模型的预测准确性。  

在这项研究中，我们开发了CoVFit，这是一个利用最先进的蛋白质语言模型ESM-2，基于S蛋白预测SARS-CoV-2变体适应性的模型。我们使用基于病毒基因组监测估计的基因型-适应性信息，以及通过高通量深度突变扫描（DMS）实验确定的关于逃避体液免疫能力的突变效应信息，对定制的ESM-2模型进行了微调。此外，使用CoVFit，我们描绘了直到2023年底的SARS-CoV-2适应性格局。  

## 结果
### 引入CoVFit
我们开发了CoVFit，这是一个基于S蛋白序列的适应性预测模型，通过对ESM-2进行微调（见图1A）。为了增加模型对冠状病毒S蛋白的了解，我们首先通过对从1506种冠状病毒中获得的S蛋白序列进行额外的预训练（即领域适应），建立了ESM-2Coronaviridae（见图1B和图S1）。ESM-2Coronaviridae模型在特定于SARS-CoV-2 S蛋白的掩码学习任务中表现出增强的预测能力，同时保持在更广泛的蛋白质集合中的性能（见图S1C）。随后，利用多任务学习框架，我们在基因型–适应性（Re）数据和DMS数据上对模型进行了微调，用于评估抗体中和逃逸能力（见图1B）。因此，对于给定的S蛋白序列，CoVFit可以预测特定国家的适应性值及其从每种单克隆抗体（mAb）逃逸的能力（见图S1A）。  

为了组建基因型–适应性数据集，我们首先将病毒序列分类为S蛋白基因型，定义为一组共享S蛋白中一组独特突变的病毒。随后，我们通过将多项逻辑模型拟合至2023年11月2日前从GISAID（https://gisaid.org/）获得的基因组监测数据，估算了每个基因型在每个国家的Re，如之前所述。因此，我们获得了总共21,751个基因型–适应性数据点，涵盖了17个国家中的12,914个基因型（见图1B和图S2A）。与先前的研究一致，后期出现的变体展示出更高的Re值，表明变体的Re在进化过程中逐渐增加（见图S2A）。  

我们利用了由Cao等人产生的关于单克隆抗体（mAbs）中和能力的体外DMS数据集。该数据集包含173,384个突变–mAb DMS数据点，涵盖S蛋白受体结合域（RBD）中的2,096种类型的突变和1,548种mAbs（见图1B和图S2B）。与先前的发现一致，突变对mAbs的影响因其抗原表位类别而异（见图S2B、S2C和S2D）。表现出更高适应性的变体，如BQ.1.1或XBB，显示出增强的逃避这些mAbs的能力，支持利用这些信息预测适应性的有效性（见图S2D）。  

使用五折交叉验证方案，我们生成了五个CoVFit模型实例（见图1B）。这些模型实例用于评估相应测试数据的性能。此外，这些实例可以为新数据（例如，在模型训练后获得的数据）提供预测的均值和方差。从此以后，这些模型实例被称为CoVFitNov23（下标表示获得基因型-适应性数据的月份和年份）。 

### CoVFit的预测性能
为了评估CoVFitNov23模型实例的预测性能，我们检查了各个模型实例使用相应测试数据集的预测性能。结果显示，适应性的预测性能非常高（Spearman相关性：0.992）（图2A和2B）。该模型成功预测了后期出现变体的更高适应性（图2C）。此外，对mAbs中和逃逸能力的预测也达到了中等至高的性能（每个抗原表位类的Spearman相关性：0.551-0.810）（图2A和S3A）。模型的较高预测性能也在按采样国家和mAb类型分层的适应性和免疫逃逸能力评估中得到了支持（图S3B和S3C）。综合来看，我们展示了CoVFit足以代表适应性格局以及突变对多种类型mAbs逃逸效应的影响。  

### CoVFit对未知、未来变体的预测性能
这项研究旨在开发一种预测模型，能够准确评估尚未出现的变体以及已知变体的适应性。然而，对于模型未知的变体，特别是那些在模型创建后出现的未来变体的预测性能无法评估，如果训练数据包含与测试数据集高度相似的变体，就像上面的性能测试一样（图2）。为了评估模型对这些未来变体的性能，我们通过根据变体出现日期将现有基因型-适应性数据集分为“过去”和“未来”变体，生成了数据集（图3A）。随后，我们仅使用过去变体数据集生成了五个CoVFit实例，并使用五折交叉验证方案，然后评估其对未来变体数据集的性能。  

基因型-适应性数据集因此使用2022年8月31日的截止日期进行了划分。应用此截止日期，Omicron系列在2022年末至2023年间出现的，包括BQ.1（及其亚系BQ.1.1；支系22E）、CH.1.1（支系23C）、XBB系列（支系22F、23A、23B、23D、23E和23F）和BA.2.86（支系23I）被排除在过去的数据集之外（图3A）。这个截止日期使我们能够测试在两种不同的进化情景下适应性提升的预测性能：顺序进化（BQ.1和CH.1.1分别从BA.5和BA.2.75出现）和跃变式进化（XBB从BA.2出现）。  

经过训练的模型实例，CoVFitAug22，成功预测了未来变体的适应性高于过去变体（图3B）。此外，尽管CoVFitAug22倾向于低估未来变体的适应性（估计斜率：0.380），但在这些未来变体中仍观察到较高的正相关性（Spearman相关性：0.761）（图3C和3D）。在每个国家分层分析的结果中观察到未来变体的正相关性是稳健的（图3E）。这些结果表明CoVFitAug22具有预测未来变体相对适应性的能力。此外，虽然XBB系列在出现时在S蛋白中有14个独特的突变，CoVFitAug22成功预测了XBB系列相对于其他未来变体（包括BQ.1.1）的更高适应性，这突显了CoVFit的高度概括性（图3D）。  

为了提供CoVFitAug22性能的更详细评估，我们比较了主要变体的预测适应性（图3F）。在BA.5系列中，BQ.1通过获得K444T和N460K替代从BA.5演化而来。BQ.1.1随后从BQ.1演化而来，获得了额外的R346T替代。CoVFitAug22成功预测了从BA.5到BQ.1.1的顺序演化过程中的适应性提升。同样，它成功预测了CH.1.1（BA.2.75的后代，具有R346T, K444T, L452R和F486S替代）比BA.2.75具有更高的适应性。此外，CoVFitAug22成功预测了通过获得F486P这一关键替代使XBB成为主导支系的XBB系列的适应性增加。这种准确性值得注意，考虑到过去的数据集没有包括XBB序列。另一方面，CoVFitAug22未能准确预测EG.5.1和HK.3等变体相比于XBB.1.5的适应性增加，而是将它们视为大多数国家的等效变体。  

接下来，我们设定了一个额外的计算实验，以评估该模型对BA.2.86的预测性能，这是另一个通过类似跃变的进化从BA.2衍生出的谱系，其特征是在S蛋白中获得了大约30个突变（图S4）。在此分析中，根据2023年7月31日的截止日期将适应性数据集分割，以排除过去数据集中的BA.2.86谱系（包括其后代谱系JN.1）（图S4）。然后我们生成了额外的模型实例，CoVFitJul23，使用这个过去的数据集。在使用相应的未来数据集评估时，CoVFitJul23成功预测了BA.2.86相比其亲本谱系BA.2以及其他谱系包括BA.5、BQ.1和XBB的更高适应性（图S4B）。然而，它未能预测BA.2.86相比XBB的后代谱系如XBB.1.5、EG.5和HK.3的更高适应性。我们的分析展示了CoVFit的高度泛化能力，同时也提供了对其局限性的洞察，这些综合来看，使得其结果的负责任解读以及对变体适应性的具体预测成为可能。  

### 性能比较以及与其他预测模型的比较
为了评估将DMS数据纳入CoVFit对适应性预测效能的影响，我们生成了一个额外的模型实例CoVFitnoDMS，通过不使用DMS数据集进行训练，随后评估其预测性能与原始模型的对比（图3G和S5）。这个简化模型通过使用过去-未来变体数据分割方法进行实验评估，截止日期为2022年8月31日。在预测过去变体的适应性时，CoVFitnoDMS展示出与原始CoVFit相似的预测性能，无论是Spearman相关性还是估计的回归斜率。然而，在预测未来变体的适应性时，CoVFitnoDMS表现明显不足。同样，我们检查了领域适应步骤对预测性能的影响，并展示了这一步骤在实现更高性能中的贡献（图3G和S5）。去除DMS数据集的影响比省略领域适应步骤的影响更大，强调了DMS数据集整合的关键作用。总体而言，CoVFit的卓越预测性能可归因于其纳入突变的功能信息以及应用领域适应框架。  

接下来，为了评估CoVFit与其他方法的性能对比，我们构建了使用非深度学习方法的替代预测模型，如LASSO、随机森林和轻量梯度提升机（LightGBM）（图3G和S5）。在预测过去变体的适应性时，这些模型展示出与CoVFit相似的预测性能，无论是Spearman相关性还是估计的回归斜率。然而，在预测未来变体的适应性时，CoVFit超过了线性模型（LASSO）和更复杂的决策树基础模型（随机森林和LightGBM）。特别是，CoVFit的回归斜率估计显著高于其他模型，表明CoVFit在预测中的低估偏差比其他方法小。  

### 适应性提升事件在SARS-CoV-2进化中的作用

为了深入了解SARS-CoV-2的适应性格局，我们开发了基于CoVFit的系统发生学框架，分析其进化过程中的适应性提升（图4）。首先，我们构建了一个包含11,098个变体的系统发生树，这些变体对应于编码各自S蛋白基因型的病毒基因组序列。随后，我们重建了树内部节点的祖先S蛋白序列（图4A）。然后，我们利用最新的CoVFitNov23模型推断了所有节点的适应性，这些节点代表了观察到的和重建的祖先序列（图4B及Omicron和所有谱系的图S6）。我们使用五折交叉验证方案生成的模型实例，为每个节点获得了五个预测的适应性值及其平均值和标准误差。最后，我们通过比较给定节点与其父节点之间的预测适应性值，识别了适应性提升在统计上显著的分支（误差发现率；FDR<0.1）。  

在获得S蛋白突变的9,846个分支中，有549个（5.6%）分支被识别为显著适应性提升（图S6），包括Omicron谱系中的334个分支（图4C）。我们观察到，在代表主要谱系的最近共同祖先（MRCA）的分支以及在其后续多样化过程中，病毒适应性均有所增加（图4C和S6）。  

为了识别对适应性提升至关重要的突变，我们接下来通过检查获得单个突变的分支，计算了每个突变的平均适应性增益（Omicron和所有谱系的图4D和S6）。在S蛋白的受体结合域（RBD）中，特别是在其受体结合基序（RBM）中发现了适应性增益较高的突变，该基序由与ACE2的结合界面组成（图4E, 4F和S6）。此外，我们还识别了显著的非RBD突变，如N端域的Y144和H146缺失。我们发现，对适应性提升影响较大的突变也往往增强了病毒逃避体液免疫的能力（图4G）。此外，Omicron谱系中对适应性影响显著的突变倾向于在Omicron的进化过程中以趋同的方式多次获得（图4H）。这种关联在RBD突变中很明显（Nagelkerke的伪R2：0.416），但在非RBD突变中则不明显（Nagelkerke的伪R2：0.022）。  

### F456L替换的背景特定效应

我们发现，某些突变在特定的系统发生谱系中过度代表。例如，虽然R346T替换在Omicron谱系中趋同获得，但F456L替换在XBB谱系中明显过度代表（图5A）。为了量化F456L在不同谱系中的适应性效应差异，我们执行了体外突变扫描分析，利用CoVFitNov23通过计算在各种S蛋白骨架中诱导F456L，推断由此替换引起的适应性增益（图5B）。预测的F456L在XBB谱系中的适应性增益明显高于其他谱系。这些结果表明，F456L增加适应性的影响特定于XBB谱系。  

为了获得关于XBB特异的F456L效应对病毒适应性的机械洞察，我们分析了已发表的DMS数据。这包括Cao等人的mAb中和数据以及Taylor和Starr的RBD ACE2结合亲和力和蛋白稳定性数据。根据逃逸估算器数据，在包括祖先D614G菌株的S蛋白在内的各种谱系中，F456处的替换对中和逃逸的影响是最大的（图5C）。另一方面，这种突变在ACE2结合和蛋白表达上的效果因S蛋白背景而异。虽然F456L增强了XBB S蛋白的ACE2结合和蛋白表达，但这种替换在所有测试的S背景中对ACE2结合和/或蛋白表达有负面影响（图5D）。F456L在ACE2结合和表达上的非破坏性效果，独特于XBB，在之前的研究中的RBD和完整S DMS试验中已得到确认。这些结果表明，F456L在XBB的S蛋白上提供了优先效果，但在其他谱系的S蛋白上具有双刃剑效果。总的来说，F456L在适应性上的XBB特异性正面效应可以通过XBB特有的去除这种突变的有害效应来解释。这个例子验证了CoVFit在背景特定方式推断突变效应的有效性。  

### 基于CoVFit的体外突变扫描（DMS）预测潜在变体的适应性

为了展示CoVFit在预测适应性增强的变体出现方面的实用性，我们开发了一种模拟方法，即基于CoVFit的体外DMS。在这种方法中，我们在计算上将每一种可能的单个氨基酸替换引入到JN.1（BA.2.86.1.1）——截至2024年3月的主导变体的S蛋白中。随后，使用CoVFitNov23推断每种替换的适应性增益。值得注意的是，CoVFitNov23的训练数据集仅包括JN.1的单个序列，没有其后代谱系的序列。  

这种体外DMS分析确定了位点F456、K478和R346的替换具有最高的预测适应性增益（图6A和6B）。为了验证这些预测，我们将它们与2024年3月11日的最新基因组监测数据进行了比较。值得注意的是，携带F456、K478、R346或F456和R346组合替换的新兴JN.1亚系正在全球JN.1群体中迅速扩张（图6C）。这些结果表明CoVFitNov23成功预测了这些JN.1亚系相较于其亲本JN.1的更高适应性——有效地在它们出现或被检测到之前。综合来看，这些结果突显了基于CoVFit的模拟分析能力，能预先预测具有更高流行潜力的变体的出现。  

### CoVFit-CLI工具

训练好的CoVFitNov23模型实例可作为命令行工具CoVFit-CLI，从我们的GitHub仓库（https://github.com/TheSatoLab/CoVFit）获取。研究人员可以使用这个独立程序方便地为他们自己的SARS-CoV-2 S蛋白序列提供适应性和DMS逃逸预测。CoVFit-CLI工具将定期更新模型实例，训练的基于最新的基因组监测数据。  

## 讨论

在这项研究中，我们建立了CoVFit，一个蛋白质语言模型，用以预测SARS-CoV-2变体的相对适应性，具有高泛化性。以前的研究提出了预测与适应性强烈相关的病毒表型的机器学习模型，如免疫逃逸能力或蛋白质语法性。然而，据我们所知，CoVFit是第一个旨在直接预测病毒适应性（即Re）的机器学习模型，这代表了变体在宿主群体中的传播能力。此外，我们证明CoVFit可以用来理解SARS-CoV-2的适应性格局，并在变体出现前或刚刚检测到后即时标记出具有更高传播潜力的变体。  

CoVFit模型实例（CoVFitSep22）成功预测了由顺序进化导致的适应性增加，特别是从BA.5到BQ.1.1以及从BA.2.75到CH.1.1。此外，模型实例也成功预测了导致XBB谱系出现的跃变式进化中的适应性增加（图3）。此外，模型实例还成功预测了XBB谱系在获得F486P突变的顺序适应性提升的第一步。这种强大的泛化能力是显著的，因为在XBB出现期间通过重组在S蛋白中获得了14个突变。这种能力主要是通过对变体适应性和突变对免疫逃逸能力影响的知识进行多任务学习获得的（图3G）。另一方面，我们还展示了当前模型并不完全准确地泛化到所有情况。例如，CoVFit模型实例（CoVFitSep22和CoVFitJul23）低估了BA.2.86出现时的适应性提升，其中一次性获得了大约30个突变（图S4）。尽管存在这种低估，但值得注意的是，该模型确实成功预测了BA.2.86相较于其祖先菌株BA.2以及随后相继出现的谱系如BA.5、BQ.1.1和XBB的显著更高的适应性。  

CoVFit有潜力改变对具有更高流行风险的SARS-CoV-2变体的基因组监测。随着SARS-CoV-2疫情的延续和当前基因组监测努力的减少，能够直接从基因型预测新出现变体的适应性的方法变得越来越重要。通过使用CoVFit扫描在病毒基因组监测数据库中新注册的病毒基因组，我们预期可以在前所未有的早期阶段识别可能具有更高适应性的变体，理想情况下在注册单个序列时就可以。这种方法允许直接检测具有更高适应性的病毒，绕过识别和命名新变体的步骤，这通常需要在公共论坛上手动指定。这种效率使得变体监测可以在更少的时间和更少的人力投入下继续进行。此外，使用CoVFit进行体外DMS的潜力可以预测在实际出现或检测之前具有高适应性的变体，正如通过成功预测具有增强生长优势的JN.1亚系所示（图6）。鉴于CoVFit的有效培训过程，该过程可以在大约24小时内完成每个模型实例的培训，使用单个Nvidia A100 GPU，CoVFit模型可以定期更新，以纳入关于最新变体的信息（见方法）。总之，一个高效的监测系统，实现最新CoVFit实例的开发将是未来工作的重点。  

在这项研究中，我们开发了一个结合CoVFit和系统发生方法的框架，以识别增强病毒适应性的突变（图4和5）。尽管在机器学习模型中普遍面临解释性的挑战，我们的框架旨在评估特定突变的平均效应以及它们的背景特定或上位性效应。例如，它能够区分特定突变（如F456L）在不同背景中（如在XBB谱系内与其他谱系之间）的不同影响（图5）。这个框架是体外DMS的宝贵补充。与体外DMS相比，这种方法旨在回顾性地解释观察到的进化步骤，并识别其出现的模式。  

以前的研究报告称，一些突变在SARS-CoV-2的进化过程中可能由于这些趋同突变对病毒适应性有积极影响而被趋同获得。实际上，一些研究根据突变被趋同获得的频率推断了突变对病毒适应性的重要性，假设这两个特征是相关的。然而，尽管我们之前的调查集中在有限的突变集上，突变的获得频率与其对适应性的影响之间的关联程度仍然不清楚。在本研究中，我们全面调查了这个问题，并发现这两个特征之间存在关联，尤其是在受体结合域（RBD）中的突变观察到特别强的相关性（图4H）。这一结果表明，为了准确预测病毒的进化，考虑突变的获得频率及其适应性效应是有效的。通过将未来的发展引向基于系统动力学方法的机器学习模型，整合这两个因素，我们可能能够实现精确的病毒进化预测和模拟。  

尽管CoVFit具有实用性，但其目前形式仍有几个局限性。首先，作为目标变量，我们使用了从病毒基因组监测数据估算的变体适应性（Re），这本身带有一定的不确定性和偏差。这种偏差部分是因为监测不采用随机抽样。通常，特定感染群体的样本在监测数据中被不成比例地代表，可能导致对某些变体适应性的估计存在偏差。其次，用于估计变体适应性的逻辑模型在一个强假设下运行，即变体之间的相对适应性随时间保持不变。虽然这个模型被广泛使用，但这个假设可能并非总是成立。实际上，变体的相对适应性可能会因宿主群体免疫状态的变化而变化，受到自然感染和疫苗接种等因素的影响。第三，在我们的适应性预测任务中，我们使用了来自现实世界变体的序列作为训练输入。对适应性有显著负面影响的突变在我们的训练数据集中必定被低估，因为这样的突变通常会通过自然选择被淘汰。因此，CoVFit可能会低估某些突变对适应性的负面影响。此外，应注意当前模型倾向于低估未来变体的适应性（图3）。其他技术限制及其潜在解决方案在方法部分的CoVFit改进空间中进行了讨论。综合来看，我们模型所作的适应性预测应在补充信息的背景下谨慎解读。   

尽管有上述限制，CoVFit具有解析病毒适应性格局的潜力。我们的方法有望为早期预测未来流行病变体和推进病毒进化预测的创新方法做出贡献。这些进展对于有效的流行病控制、疫苗开发和药物发现至关重要。此外，CoVFit中使用的方法论可以应用于预测其他病毒（包括引起未来大流行的病毒病原体）的适应性。鉴于下一次大流行的预期，不断发展基础生物信息学方法以协助流行病控制是至关重要的，利用SARS-CoV-2作为典型的大量基因组数据努力。  




